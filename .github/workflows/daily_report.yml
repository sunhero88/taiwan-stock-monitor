name: Global Market Monitor

# è¨­å®šè§¸ç™¼æ¢ä»¶
on:
  workflow_dispatch: # å…è¨±æ‰‹å‹•é»æ“ŠåŸ·è¡Œï¼ˆæ¸¬è©¦ç”¨ï¼‰
  schedule:
    - cron: '30 8 * * *' # æ¯æ—¥å°åŒ—æ™‚é–“ 16:30 è‡ªå‹•åŸ·è¡Œ

jobs:
  market-analysis:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ä¸‹è¼‰æ‚¨çš„ç¨‹å¼ç¢¼
      - name: Checkout Code
        uses: actions/checkout@v3

      # 2. è¨­å®š Python ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. å®‰è£å¿…è¦å¥—ä»¶ (åŒ…å«åˆ†æèˆ‡ç™¼ä¿¡æ‰€éœ€çš„æ‰€æœ‰åº«)
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy requests yfinance matplotlib tqdm akshare resend openai

      # 4. åŸ·è¡Œä¸»ç¨‹å¼
      - name: Run Stock Analysis
        # ğŸ’¡ é€™è£¡æ˜¯æœ€é—œéµçš„ï¼šå°‡ GitHub Secrets è½‰æ›ç‚ºç¨‹å¼è®€å¾—åˆ°çš„ç’°å¢ƒè®Šæ•¸
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
          REPORT_RECEIVER_EMAIL: ${{ secrets.REPORT_RECEIVER_EMAIL }}
        # ğŸ’¡ åŸ·è¡Œ main.pyï¼Œä¸¦æŒ‡å®šåˆ†æå°è‚¡ (tw-share)
        run: python main.py --market tw-share
