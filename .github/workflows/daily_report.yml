name: Global Market Monitor

# è¨­å®šè§¸ç™¼æ¢ä»¶
on:
  workflow_dispatch: # å…è¨±æ‰‹å‹•é»æ“ŠåŸ·è¡Œ
  schedule:
    - cron: '30 8 * * *' # æ¯æ—¥å°åŒ—æ™‚é–“ 16:30 è‡ªå‹•åŸ·è¡Œ

jobs:
  market-analysis:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ä¸‹è¼‰æ‚¨çš„æœ€æ–°ç¨‹å¼ç¢¼
      - name: Checkout Code
        uses: actions/checkout@v3

      # 2. è¨­å®š Python 3.10 ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. å®‰è£æ‰€æœ‰å¿…è¦å¥—ä»¶ (åŒ…å« Gemini SDK)
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy requests yfinance matplotlib tqdm akshare resend google-generativeai

      # 4. åŸ·è¡Œä¸»ç¨‹å¼ä¸¦æ³¨å…¥ç’°å¢ƒè®Šæ•¸
      - name: Run Stock Analysis
        env:
          # ğŸ’¡ é€™è£¡å°‡ GitHub Secrets å°æ¥åˆ° Python ç¨‹å¼ç¢¼ä¸­
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
          REPORT_RECEIVER_EMAIL: ${{ secrets.REPORT_RECEIVER_EMAIL }}
        run: python main.py --market tw-share
